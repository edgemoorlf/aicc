<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI催收工作面板 - Firefox OGG/Opus优化版</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>AI催收工作面板 - OGG版</h1>
        </header>

        <!-- Demo Controls -->
        <section class="demo-controls">
            <button id="session-toggle" class="btn btn-primary btn-main">开始对话</button>
            
            <div class="control-group">
                <label for="customer-select">客户:</label>
                <select id="customer-select">
                    <option value="">选择客户...</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="scenario-select">场景:</label>
                <select id="scenario-select">
                    <option value="overdue_payment">逾期付款</option>
                    <option value="payment_plan">还款计划</option>
                    <option value="difficult_customer">困难客户</option>
                    <option value="first_contact">首次联系</option>
                </select>
            </div>

            <button id="record-btn" class="btn btn-success" disabled>
                <span class="record-text">开始监听</span>
            </button>
            <button id="metrics-toggle" class="btn btn-info">指标监控</button>
            <button id="reset-session" class="btn btn-tertiary">重置</button>
            <button id="test-btn" class="btn btn-success">测试音频</button>
        </section>

        <!-- TTS Tone Control Panel -->
        <section class="tone-controls" id="tone-controls">
            <div class="control-header">
                <h3>语音控制</h3>
                <button id="toggle-tone-controls" class="btn btn-small">展开</button>
            </div>
            
            <div class="tone-content" id="tone-content" style="display: none;">
                <div class="tone-group">
                    <div class="control-group">
                        <label for="voice-speed">语速:</label>
                        <input type="range" id="voice-speed" min="0.5" max="2.0" step="0.1" value="1.0">
                        <span id="speed-value" class="control-value">1.0x</span>
                    </div>
                    
                    <div class="control-group">
                        <label for="voice-pitch">音调:</label>
                        <input type="range" id="voice-pitch" min="0.5" max="2.0" step="0.1" value="1.0">
                        <span id="pitch-value" class="control-value">1.0x</span>
                    </div>
                    
                    <div class="control-group">
                        <label for="voice-volume">音量:</label>
                        <input type="range" id="voice-volume" min="0.1" max="1.0" step="0.1" value="0.8">
                        <span id="volume-value" class="control-value">80%</span>
                    </div>
                    
                    <div class="control-group">
                        <label for="voice-selection">声音:</label>
                        <select id="voice-selection">
                            <option value="Cherry" selected>Cherry (中文女声)</option>
                            <option value="Serena">Serena (中文女声)</option>
                            <option value="Ethan">Ethan (中文男声)</option>
                            <option value="Chelsie">Chelsie (中文女声)</option>
                            <option value="Dylan">Dylan (北京男声)</option>
                            <option value="Jada">Jada (上海女声)</option>
                            <option value="Sunny">Sunny (四川女声)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="voice-tone">语调:</label>
                        <select id="voice-tone">
                            <option value="neutral">中性</option>
                            <option value="friendly">友好</option>
                            <option value="professional" selected>专业</option>
                            <option value="gentle">温和</option>
                            <option value="confident">自信</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="voice-emotion">情感:</label>
                        <select id="voice-emotion">
                            <option value="neutral">中性</option>
                            <option value="professional" selected>专业</option>
                            <option value="understanding">理解</option>
                            <option value="patient">耐心</option>
                            <option value="firm">坚定</option>
                        </select>
                    </div>
                    
                    <div class="control-actions">
                        <button id="test-voice" class="btn btn-primary btn-small">测试语音</button>
                        <button id="reset-voice" class="btn btn-secondary btn-small">重置默认</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Customer Info Panel -->
        <section class="customer-info" id="customer-info" style="display: none;">
            <h3>客户信息</h3>
            <div class="info-grid">
                <div class="info-item">
                    <label>姓名:</label>
                    <span id="customer-name">--</span>
                </div>
                <div class="info-item">
                    <label>电话:</label>
                    <span id="customer-phone">--</span>
                </div>
                <div class="info-item">
                    <label>逾期金额:</label>
                    <span id="customer-balance">--</span>
                </div>
                <div class="info-item">
                    <label>逾期天数:</label>
                    <span id="customer-overdue">--</span>
                </div>
                <div class="info-item">
                    <label>风险等级:</label>
                    <span id="customer-risk">--</span>
                </div>
                <div class="info-item">
                    <label>联系次数:</label>
                    <span id="customer-contacts">--</span>
                </div>
            </div>
        </section>

        <!-- Main Interface -->
        <div class="main-interface" id="main-interface">
            <!-- Conversation Area -->
            <section class="conversation-area">
                <div class="conversation-header">
                    <h3>对话记录</h3>
                    <div class="connection-status">
                        <span id="connection-indicator" class="status-indicator offline"></span>
                        <span id="connection-text">未连接</span>
                    </div>
                </div>
                
                <div id="conversation-display" class="conversation-display">
                    <div class="welcome-message">
                        请选择客户并开始对话
                    </div>
                </div>
            </section>

            <!-- Metrics Dashboard -->
            <section class="metrics-dashboard" id="metrics-dashboard" style="display: none;">
                <div class="dashboard-header">
                    <h3>性能指标</h3>
                    <button id="toggle-metrics" class="btn btn-small">展开</button>
                </div>
                
                <div class="metrics-content" id="metrics-content">
                    <!-- Latency Metrics -->
                    <div class="metric-group">
                        <h4>延迟指标</h4>
                        <div class="metric-item">
                            <span class="metric-label">总延迟:</span>
                            <span id="current-latency" class="metric-value">-- ms</span>
                            <span id="latency-grade" class="metric-grade">--</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">ASR延迟:</span>
                            <span id="asr-latency" class="metric-value">-- ms</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">LLM延迟:</span>
                            <span id="llm-latency" class="metric-value">-- ms</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">TTS延迟:</span>
                            <span id="tts-latency" class="metric-value">-- ms</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">平均延迟:</span>
                            <span id="avg-latency" class="metric-value">-- ms</span>
                        </div>
                        <div class="latency-chart">
                            <canvas id="latency-chart" width="250" height="80"></canvas>
                        </div>
                    </div>

                    <!-- Accuracy Metrics -->
                    <div class="metric-group">
                        <h4>准确性指标</h4>
                        <div class="metric-item">
                            <span class="metric-label">语音识别:</span>
                            <span id="speech-accuracy" class="metric-value">--%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">回复质量:</span>
                            <span id="response-quality" class="metric-value">--%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">文化适宜性:</span>
                            <span id="cultural-score" class="metric-value">--%</span>
                        </div>
                    </div>

                    <!-- Session Stats -->
                    <div class="metric-group">
                        <h4>会话统计</h4>
                        <div class="metric-item">
                            <span class="metric-label">对话轮次:</span>
                            <span id="turn-count" class="metric-value">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">会话时长:</span>
                            <span id="session-duration" class="metric-value">00:00</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">成功率:</span>
                            <span id="success-rate" class="metric-value">--%</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Debug Console -->
        <section class="debug-console" id="debug-console" style="display: none;">
            <div class="debug-header">
                <h4>调试信息</h4>
                <button id="toggle-debug" class="btn btn-small">显示</button>
                <button id="clear-debug" class="btn btn-small">清除</button>
            </div>
            <div class="debug-content" id="debug-content">
                <pre id="debug-log"></pre>
            </div>
        </section>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text">正在连接AI助手...</div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="config.js"></script>
    
    <!-- Refactored modular components -->
    <script src="js/AudioManager.js"></script>
    <script src="js/WebSocketManager.js"></script>
    <script src="js/MetricsManager.js"></script>
    <script src="js/UIManager.js"></script>
    <script src="js/websocket-client-refactored.js"></script>
    
    <!-- Original version (commented out) -->
    <!-- <script src="websocket-client.js"></script> -->
</body>
</html>